<apex:page sidebar="false" showHeader="true" title="Program Roadmap" tabStyle="Program_Roadmap__tab" controller="SparkIt_Charts_GanttController"> 
    
  <apex:includeScript value="{!URLFOR($Resource.Milestone1_Charts, 'jquery-1.4.4.min.js')}"/>
  <apex:includeScript value="{!URLFOR($Resource.Milestone1_Charts, 'date.js')}"/>
  <apex:includeScript value="{!URLFOR($Resource.Milestone1_Charts, 'jquery-ui-1.8.7.custom.min.js')}"/>
  <apex:includeScript value="{!URLFOR($Resource.Milestone1_Charts, 'jquery.ganttView.js')}"/>
  <apex:stylesheet value="{!URLFOR($Resource.Milestone1_Charts, 'jquery-ui-1.8.4.css')}"/>
  <apex:stylesheet value="{!URLFOR($Resource.Milestone1_Charts, 'reset.css')}"/>
  <apex:stylesheet value="{!URLFOR($Resource.Milestone1_Charts, 'jquery.ganttView.css')}"/>
  <apex:includeScript value="/soap/ajax/20.0/connection.js"/>
  
  <apex:outputPanel id="panel">
    <apex:form id="frm">
      <apex:pageMessages id="pageMessage" />
      <script type="text/javascript">
        function loadfunction(){
          var filterSize = 360;
          document.getElementById('{!$Component.filter}').style.width = filterSize + 'px';
          document.getElementById('{!$Component.result}').style.width = window.screen.availWidth - filterSize - 60 + 'px';
          jQuery('.hideListButton').each(function() {
            twistSection(this); 
          });
        }
  
  
        //window.onload = loadfunction;
        jQuery(document).ready(loadfunction);
      </script>
    <apex:outputpanel >
      <apex:actionstatus id="statusC">
        <apex:facet name="start">
          <div class="waitingSearchDiv" id="el_loading" style="background-color: #fbfbfb;
                 height: 100%;opacity:0.65;width:100%;">
             <div class="waitingHolder" style="top: 100px; width: 100px;">
                 <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
                 <span class="waitingDescription">Please Wait...</span>
             </div>
          </div>
        </apex:facet>
      </apex:actionstatus>
    </apex:outputpanel>
    
    <apex:outputPanel id="upperPanel"> 
    <table><tr><td style="width: 310px;vertical-align: top;">
    <apex:outputPanel style="width:360px;" id="filter" layout="block" >
      <apex:pageBlock title="Filters">
        <apex:pageBlockSection columns="1" collapsible="true" title="Template">
          <!-- Template -->
          <apex:inputField value="{!milestoneProject.Template__c}" />
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" collapsible="true" title="Status">
          <!-- Status -->
          <apex:selectCheckboxes value="{!statusSelected}" title="Select Status" layout="pageDirection">
            <apex:selectOptions value="{!statusOptions}" />
          </apex:selectCheckboxes>
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" collapsible="true" title="Campaign">
          <!-- Campaign -->
          <apex:inputField value="{!milestoneProject.Campaign__c}" label="" />
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" collapsible="true" title="Division">
          <!-- Division -->
          <apex:inputField value="{!milestoneProject.Division__c}" label="" />
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" collapsible="true" title="Requester">
          <!-- Requestor -->
          <apex:inputField value="{!milestoneProject.Requestor__c}" label="" /> 
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" collapsible="true" title="Project Level">
          <!-- Project Level -->
          <apex:selectCheckboxes value="{!plSelected}" title="Select Project Level" layout="pageDirection">
            <apex:selectOptions value="{!plOptions}" />
          </apex:selectCheckboxes>
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="1" collapsible="true" title="Program Name">
          <!-- Program Name -->
          <apex:inputField value="{!milestoneProject.Name}" label="" />
        </apex:pageBlockSection>
        <apex:pageBlockSection columns="2" collapsible="true" title="Deadline">
          <!-- Deadline -->
            <apex:selectList value="{!dateMatch}" size="1" title="Select Date Criteria">
              <apex:selectOptions value="{!dateMatchOptions}" />
            </apex:selectList>
            <apex:inputField value="{!milestoneProject.Deadline__c}" label="" />
        </apex:pageBlockSection>
        <br />
        <apex:selectList value="{!match}" size="1">
          <apex:selectOptions value="{!matchOptions}" />
        </apex:selectList>
        <br /><br />
        <apex:commandButton action="{!searchSparkIts}" value="Search"  status="statusC" reRender="check, pageMessage" onComplete="displayChart();"/>
      </apex:pageBlock>
    </apex:outputPanel>
  </td><td style="vertical-align: top;text-align:left;">
    <apex:outputPanel id="result" layout="block"> 
      <apex:outputPanel id="check">
          <div id="ganttChart"></div>
    
    <script type="text/javascript">
        var ganttDatasparks = {!projectGanttJson};
        //var JQ = jQuery.noConflict();
        
        jQuery(function () {
            var dropEvent = function (data) {
            var startDate = data["start"];
            var endDate = data["end"];
            var id = data["id"];
            var sobject; 
            sobject = new sforce.SObject("{!objectType}");
            sobject["{!idFieldName}"] = id;
            sobject["{!startDateFieldName}"] = startDate;
            sobject["{!endDateFieldName}"] = endDate;
                
            sforce.connection.sessionId = "{!$Api.Session_ID}";
            sforce.connection.update([sobject],{
                    onSuccess : function(result){
                                },
                    onFailure : function(result){
                                    alert('{!$Label.Milestone1_AnErrorHasOcurred}' +': '+result);
                                }
            })
        }
        var readonly = true;
        
        function displayChart() {
          jQuery("#ganttChart").ganttView({ 
              data: ganttDatasparks,
              slideWidth: 900,
              behavior: {
                  draggable: readonly,
                  resizable: readonly, 
                  onClick: function (data) {
                      if(data && data.id){
                          parent.location.href = '/'+data.id;
                      }
                  },
                  onResize: dropEvent,
                  onDrag: dropEvent
              }
          });
       } 
       displayChart();
     });
     
    </script>
      </apex:outputPanel>
    </apex:outputPanel>
    </td></tr></table>
    </apex:outputPanel>
    </apex:form>
    </apex:outputPanel>
    

    
</apex:page>